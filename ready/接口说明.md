# Mercari 商品分类接口说明

服务地址：`http://43.133.171.134:39008`

本服务提供两类接口：
- **图片分析接口**：上传商品图片，生成标题、描述、价格、分类和品牌信息。
- **商品标题分类接口**：基于标题获取分类，若标题无法分类可用图片 URL 兜底。

---

## 1. 图片分析接口

- 方法：`POST`
- 路径：`/api/v1/mercari/image/analyze`
- Content-Type：`multipart/form-data`
- 文件限制：最大 5MB；格式 `image/jpeg`、`image/png`、`image/webp`

### 1.1 请求参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `image` | file | ✓ | 商品图片（单张） |
| `language` | string | ✗ | 输出语言：`ja` / `en` / `zh`，默认 `ja` |
| `debug` | boolean/string | ✗ | 是否返回调试信息，默认 `false` |

### 1.2 成功响应示例

```json
{
  "title": "Nintendo Switch Lite ターコイズ 本体",
  "description": "状態は良好で、付属品は本体のみです。動作確認済みです。",
  "prices": [8500, 9000, 9500],
  "categories": [
    { "id": "003", "name": "CD・DVD・ブルーレイ > CD > アニメ" },
    { "id": "002", "name": "CD・DVD・ブルーレイ > CD > その他" },
    { "id": "001", "name": "CD・DVD・ブルーレイ > CD > K-POP・アジア" }
  ],
  "best_target_path": "CD・DVD・ブルーレイ > CD > アニメ",
  "best_category_id": "003",
  "brand_name": "Nintendo",
  "brand_id": "123456"
}
```

### 1.3 字段说明

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `title` | string | 生成的标题 |
| `description` | string | 生成的描述 |
| `prices` | array[int] | 3 个价格建议（JPY） |
| `categories` | array[object] | 0-3 条分类候选 `{id, name}` |
| `best_target_path` | string | 首选分类路径（等同于 `categories[0].name`） |
| `best_category_id` | string | 首选分类 ID（等同于 `categories[0].id`） |
| `brand_name` | string | 品牌名称（未命中品牌库则为空） |
| `_debug` | object | 仅 `debug=true` 时返回，含 LLM 原始输出 |

### 1.4 调用示例

```bash
curl -X POST http://43.133.171.134:39008/api/v1/mercari/image/analyze \
  -F "image=@/path/to/item.jpg" \
  -F "language=ja" \
  -F "debug=false"
```

### 1.5 注意事项

- 单次仅支持一张图片。
- 价格单位为日元（JPY）。
- 分类候选来自平台数据集；首选分类以 `best_target_path` / `best_category_id` 返回。
- 品牌识别基于预定义品牌库，未命中则为空字符串。

---

## 2. 商品标题分类接口（可图片兜底）

- 方法：`POST`
- 路径：`/api/v1/mercari/title/analyze`
- Content-Type：`application/json`

### 2.1 请求体

| 字段 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| `title` | string | ✓ | 商品标题 |
| `image_url` | string | ✗ | 兜底图片 URL（标题分类失败时使用） |
| `language` | string | ✗ | 标题语言：`ja` / `en` / `zh`，默认 `ja` |

### 2.2 处理流程

1. 基于标题调用分类模型，选出一级分类并在其下选择最佳路径。
2. 若标题无法得到有效分类且提供了 `image_url`，则使用图片识别兜底。
3. 始终返回 `best_target_path` 与 `best_category_id`，并附带可用的 `alternatives`。

### 2.3 成功响应示例

```json
{
  "best_target_path": "ファッション > メンズ > 小物 > 折り財布 > 二つ折り財布",
  "best_category_id": "123456",
  "alternatives": [
    { "target_path": "ファッション > メンズ > 小物 > 折り財布 > その他", "category_id": "123457" },
    { "target_path": "ファッション > メンズ > 小物 > その他", "category_id": "123458" }
  ]
}
```

### 2.4 错误响应

- 400：缺少 `title`、语言非法，或兜底所需的 `image_url` 无效/缺失。
- 502：LLM 请求失败。

### 2.5 调用示例

```bash
curl -X POST http://43.133.171.134:39008/api/v1/mercari/title/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "title": "CB400SF VTEC REVO 専用 ハイスロKIT・ブラックアウターSET",
    "language": "ja",
    "image_url": "https://example.com/item.jpg"
  }'
```
