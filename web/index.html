<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mercari å•†å“ç”»åƒè­˜åˆ¥ãƒ†ã‚¹ã‚¿ãƒ¼</title>
    <style>
      :root {
        --bg: #f7f8fa;
        --card: #ffffff;
        --text: #1c1f25;
        --muted: #6b7280;
        --accent: #2f80ed;
        --border: #e5e7eb;
        --danger: #e11d48;
        --success: #16a34a;
        --warning: #f59e0b;
        --shadow: 0 14px 40px rgba(15, 23, 42, 0.08);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        background: radial-gradient(circle at 10% 20%, #eef2ff 0, transparent 25%),
          radial-gradient(circle at 80% 0%, #e0f2fe 0, transparent 28%),
          var(--bg);
        color: var(--text);
        font-family: "Inter", "Noto Sans JP", system-ui, -apple-system, sans-serif;
        min-height: 100vh;
      }

      .page {
        max-width: 1200px;
        margin: 0 auto;
        padding: 28px 20px 40px;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        margin-bottom: 18px;
      }

      h1 {
        margin: 0;
        font-size: 26px;
        letter-spacing: -0.2px;
      }

      .pill {
        background: #e0e7ff;
        color: #1e3a8a;
        padding: 6px 12px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 600;
        letter-spacing: 0.1px;
      }

      .main-layout {
        display: grid;
        grid-template-columns: 1fr 320px;
        gap: 16px;
      }

      @media (max-width: 1024px) {
        .main-layout {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 18px;
        box-shadow: var(--shadow);
      }

      .tab-bar {
        display: inline-flex;
        gap: 8px;
        margin-bottom: 8px;
      }

      .tab-btn {
        border: 1px solid var(--border);
        background: white;
        color: var(--muted);
        padding: 10px 16px;
        border-radius: 10px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.15s ease;
      }

      .tab-btn.active {
        border-color: var(--accent);
        color: var(--accent);
        background: #eff6ff;
        box-shadow: 0 8px 20px rgba(47, 128, 237, 0.15);
      }

      .tab-btn:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      .hidden {
        display: none !important;
      }

      .grid {
        display: grid;
        gap: 16px;
      }

      .controls {
        display: grid;
        grid-template-columns: 1fr;
        gap: 12px;
      }

      label {
        display: block;
        font-size: 13px;
        font-weight: 600;
        color: var(--muted);
        margin-bottom: 6px;
      }

      /* æ”¹è¿›çš„æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ - æ”¯æŒæ‰¹é‡ */
      .upload-area {
        position: relative;
        border: 2px dashed var(--border);
        border-radius: 12px;
        padding: 32px 20px;
        text-align: center;
        background: #fdfdfd;
        transition: all 0.2s ease;
        cursor: pointer;
      }

      .upload-area:hover {
        border-color: var(--accent);
        background: #f8faff;
      }

      .upload-area.drag-over {
        border-color: var(--accent);
        background: #eff6ff;
        transform: scale(1.02);
      }

      .upload-icon {
        font-size: 48px;
        margin-bottom: 12px;
        opacity: 0.5;
      }

      .upload-text {
        font-size: 15px;
        color: var(--text);
        font-weight: 600;
        margin-bottom: 6px;
      }

      .upload-hint {
        font-size: 13px;
        color: var(--muted);
      }

      input[type="file"] {
        position: absolute;
        inset: 0;
        opacity: 0;
        cursor: pointer;
      }

      /* æ‰¹é‡é¢„è§ˆç½‘æ ¼ */
      .preview-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
        max-height: 300px;
        overflow-y: auto;
        padding: 2px;
      }

      .preview-item {
        position: relative;
        border: 2px solid #e0f2fe;
        border-radius: 10px;
        overflow: hidden;
        background: white;
        transition: all 0.2s ease;
      }

      .preview-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .preview-item.processing {
        border-color: var(--accent);
        animation: borderPulse 1.5s infinite;
      }

      .preview-item.success {
        border-color: var(--success);
      }

      .preview-item.error {
        border-color: var(--danger);
      }

      @keyframes borderPulse {
        0%, 100% { border-color: var(--accent); }
        50% { border-color: #93c5fd; }
      }

      .preview-item img {
        width: 100%;
        height: 140px;
        object-fit: cover;
      }

      .preview-item .info {
        padding: 8px;
        font-size: 11px;
        color: var(--muted);
        text-align: left;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .preview-item .status-badge {
        position: absolute;
        top: 6px;
        right: 6px;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 600;
        background: rgba(255, 255, 255, 0.95);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .preview-item .remove-btn {
        position: absolute;
        top: 6px;
        left: 6px;
        width: 24px;
        height: 24px;
        padding: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.95);
        color: var(--danger);
        font-size: 16px;
        line-height: 1;
        cursor: pointer;
        border: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      /* æ”¹è¿›çš„è¾“å…¥æ¡†æ ·å¼ */
      select,
      input[type="text"] {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid var(--border);
        border-radius: 10px;
        background: #fdfdfd;
        font-size: 14px;
        transition: all 0.2s ease;
        font-family: inherit;
      }

      select:focus,
      input[type="text"]:focus {
        outline: none;
        border-color: var(--accent);
        background-color: white;
        box-shadow: 0 0 0 3px rgba(47, 128, 237, 0.1);
      }

      select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%236b7280' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 14px center;
        padding-right: 40px;
      }

      button {
        width: 100%;
        border: none;
        background: linear-gradient(135deg, var(--accent), #1d4ed8);
        color: white;
        padding: 14px 16px;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 700;
        cursor: pointer;
        transition: transform 0.08s ease, box-shadow 0.08s ease;
        box-shadow: 0 10px 25px rgba(47, 128, 237, 0.2);
      }

      button:disabled {
        opacity: 0.7;
        cursor: not-allowed;
      }

      button:not(:disabled):hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 32px rgba(47, 128, 237, 0.28);
      }

      button.secondary {
        background: white;
        color: var(--text);
        border: 2px solid var(--border);
        box-shadow: none;
      }

      button.secondary:hover {
        background: #f8fafc;
      }

      /* ç»Ÿè®¡é¢æ¿ */
      .stats-panel {
        position: sticky;
        top: 20px;
      }

      .stats-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .stats-header h2 {
        margin: 0;
        font-size: 18px;
      }

      .clear-btn {
        width: auto;
        padding: 6px 12px;
        font-size: 12px;
        background: transparent;
        color: var(--danger);
        border: 1px solid var(--danger);
        box-shadow: none;
      }

      .stat-card {
        padding: 16px;
        border-radius: 10px;
        background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
        margin-bottom: 12px;
      }

      .stat-label {
        font-size: 12px;
        color: var(--muted);
        margin-bottom: 8px;
      }

      .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: var(--text);
      }

      .stat-breakdown {
        display: grid;
        gap: 8px;
        margin-top: 12px;
      }

      .stat-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 12px;
        background: white;
        border-radius: 8px;
        border-left: 4px solid;
      }

      .stat-item.accurate {
        border-left-color: var(--success);
      }

      .stat-item.moderate {
        border-left-color: var(--warning);
      }

      .stat-item.inaccurate {
        border-left-color: var(--danger);
      }

      .stat-item-label {
        font-size: 13px;
        font-weight: 600;
      }

      .stat-item-value {
        font-size: 14px;
        font-weight: 700;
      }

      .stat-item-percent {
        font-size: 11px;
        color: var(--muted);
        margin-left: 6px;
      }

      /* è¿›åº¦æ¡ */
      .progress-bar {
        width: 100%;
        height: 8px;
        background: #e5e7eb;
        border-radius: 999px;
        overflow: hidden;
        margin-top: 8px;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--accent), #1d4ed8);
        transition: width 0.3s ease;
      }

      /* ç»“æœå¡ç‰‡ */
      .results-section {
        margin-top: 16px;
      }

      .result-card {
        border: 2px solid var(--border);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        background: white;
        transition: all 0.2s ease;
      }

      .result-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }

      .result-header {
        display: flex;
        gap: 16px;
        margin-bottom: 16px;
      }

      .result-image {
        width: 120px;
        height: 120px;
        border-radius: 8px;
        object-fit: cover;
        border: 2px solid #e5e7eb;
        flex-shrink: 0;
      }

      .result-meta {
        flex: 1;
      }

      .result-filename {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--text);
      }

      .result-stats {
        display: flex;
        gap: 16px;
        font-size: 12px;
        color: var(--muted);
        margin-bottom: 12px;
      }

      /* ç»“æ„åŒ–æ•°æ®å±•ç¤º */
      .result-structured {
        background: #f8fafc;
        border-radius: 10px;
        padding: 16px;
        margin-bottom: 12px;
      }

      .field-group {
        margin-bottom: 16px;
      }

      .field-group:last-child {
        margin-bottom: 0;
      }

      .field-label {
        font-size: 11px;
        font-weight: 700;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 6px;
      }

      .field-value {
        font-size: 14px;
        color: var(--text);
        line-height: 1.6;
        background: white;
        padding: 10px 12px;
        border-radius: 6px;
        border: 1px solid var(--border);
      }

      .field-value.large {
        font-size: 18px;
        font-weight: 600;
      }

      .tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .tag {
        display: inline-block;
        padding: 6px 12px;
        background: white;
        border: 1px solid var(--border);
        border-radius: 6px;
        font-size: 13px;
        color: var(--text);
      }

      .tag.primary {
        background: #dbeafe;
        border-color: #3b82f6;
        color: #1e40af;
        font-weight: 600;
      }

      /* å±•å¼€/æ”¶èµ·æŒ‰é’® */
      .toggle-json {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        font-size: 12px;
        color: var(--accent);
        background: transparent;
        border: 1px solid var(--accent);
        border-radius: 6px;
        cursor: pointer;
        margin-bottom: 12px;
        width: auto;
        box-shadow: none;
      }

      .toggle-json:hover {
        background: #eff6ff;
      }

      .raw-json {
        display: none;
        font-family: "JetBrains Mono", monospace;
        font-size: 12px;
        background: #0b1220;
        color: #d7e1ff;
        padding: 12px;
        border-radius: 8px;
        max-height: 300px;
        overflow-y: auto;
        margin-top: 8px;
        line-height: 1.6;
      }

      .raw-json.show {
        display: block;
      }

      /* è¯„ä»·æŒ‰é’®ç»„ */
      .rating-section {
        border-top: 1px solid var(--border);
        padding-top: 16px;
        margin-top: 16px;
      }

      .rating-buttons {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        margin-top: 8px;
      }

      .rating-btn {
        width: 100%;
        padding: 10px 12px;
        font-size: 13px;
        font-weight: 600;
        border-radius: 8px;
        border: 2px solid;
        background: white;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .rating-btn.accurate {
        border-color: var(--success);
        color: var(--success);
      }

      .rating-btn.accurate:hover,
      .rating-btn.accurate.active {
        background: var(--success);
        color: white;
      }

      .rating-btn.moderate {
        border-color: var(--warning);
        color: var(--warning);
      }

      .rating-btn.moderate:hover,
      .rating-btn.moderate.active {
        background: var(--warning);
        color: white;
      }

      .rating-btn.inaccurate {
        border-color: var(--danger);
        color: var(--danger);
      }

      .rating-btn.inaccurate:hover,
      .rating-btn.inaccurate.active {
        background: var(--danger);
        color: white;
      }

      .spinner {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      .status {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 14px;
        color: var(--muted);
      }

      .dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--muted);
        transition: all 0.3s ease;
      }

      .dot.live {
        background: var(--accent);
        box-shadow: 0 0 12px rgba(47, 128, 237, 0.6);
        animation: pulse 1.2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%, 100% {
          transform: scale(0.95);
          opacity: 0.7;
        }
        50% {
          transform: scale(1.3);
          opacity: 1;
        }
      }

      .controls-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 12px;
      }

      .models-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 12px;
        margin-top: 8px;
      }

      @media (max-width: 640px) {
        .controls-row {
          grid-template-columns: 1fr;
        }
        
        .result-header {
          flex-direction: column;
        }
        
        .result-image {
          width: 100%;
          height: 200px;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <header>
        <div>
          <h1 id="page-title">Mercari å•†å“å›¾ç‰‡è¯†åˆ«æµ‹è¯•</h1>
          <p class="status">
            <span class="dot" id="status-dot"></span>
            <span id="status-text">å¾…å‘½</span>
          </p>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
          <div>
            <select id="ui-language" style="width: auto; padding: 8px 30px 8px 12px; border-radius: 999px;">
              <option value="zh" selected>ä¸­æ–‡</option>
              <option value="ja">æ—¥è¯­</option>
            </select>
          </div>
          <span class="pill" id="beta-pill">æ‰¹é‡æµ‹è¯•ç‰ˆ</span>
        </div>
      </header>

      <div class="main-layout">
        <!-- å·¦ä¾§ä¸»è¦å†…å®¹ -->
        <div class="grid">
          <div class="tab-bar">
            <button class="tab-btn active" id="tab-image">å›¾ç‰‡è¯†åˆ«</button>
            <button class="tab-btn" id="tab-title">æ ‡é¢˜åˆ†ç±»</button>
          </div>

          <div class="card grid" id="image-card">
            <!-- æ‰¹é‡æ–‡ä»¶ä¸Šä¼  -->
            <div>
              <label id="upload-label">å•†å“å›¾ç‰‡ï¼ˆæ”¯æŒæ‰¹é‡ä¸Šä¼ ï¼‰</label>
              <div class="upload-area" id="upload-area">
                <div class="upload-icon">ğŸ“¸</div>
                <div class="upload-text" id="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</div>
                <div class="upload-hint" id="upload-hint">æ”¯æŒå¤šé€‰ï¼ŒJPGã€PNGã€GIF ç­‰æ ¼å¼</div>
                <input type="file" id="image" accept="image/*" multiple />
              </div>
            </div>

            <!-- æ‰¹é‡é¢„è§ˆ -->
            <div id="preview-container" style="display: none">
              <label id="preview-label">å·²é€‰æ‹© <span id="file-count">0</span> å¼ å›¾ç‰‡</label>
              <div class="preview-grid" id="preview-grid"></div>
            </div>

            <!-- é…ç½®é€‰é¡¹ -->
            <div class="controls-row">
              <div>
                <label for="language" id="output-language-label">æ ‡é¢˜/æè¿°è¯­è¨€</label>
                <select id="language">
                  <option value="ja" selected id="lang-opt-ja">æ—¥è¯­</option>
                  <option value="en" id="lang-opt-en">è‹±è¯­</option>
                  <option value="zh" id="lang-opt-zh">ç®€ä½“ä¸­æ–‡</option>
                </select>
              </div>
              <div>
                <label for="category-count" id="category-count-label">è¿”å›ç±»åˆ«ä¸ªæ•°</label>
                <select id="category-count">
                  <option value="1" selected>1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                </select>
              </div>
              <div>
                <label for="price-strategy" id="price-strategy-label">ä»·æ ¼ç­–ç•¥</label>
                <select id="price-strategy">
                  <option value="vision" selected id="price-strategy-default">é»˜è®¤(æ¨ç†)</option>
                  <option value="vision_online" id="price-strategy-online">æœç´¢æ¨¡å¼(é€Ÿåº¦è¾ƒæ…¢)</option>
                  <option value="dedicated" id="price-strategy-dedicated">ç‹¬ç«‹æ¨¡å‹+æœç´¢(ä¼˜å…ˆç²¾åº¦)</option>
                </select>
              </div>
            </div>

            <div class="models-row">
              <!-- <div>
                <label for="vision-model" id="vision-model-label">è§†è§‰æ¨¡å‹</label>
                <input type="text" id="vision-model" value="" placeholder="ç•™ç©ºä½¿ç”¨é»˜è®¤è§†è§‰æ¨¡å‹" />
              </div>
              <div>
                <label for="category-model" id="category-model-label">åˆ†ç±»æ¨¡å‹</label>
                <input type="text" id="category-model" value="" placeholder="ç•™ç©ºä½¿ç”¨é»˜è®¤åˆ†ç±»æ¨¡å‹" />
              </div>
              <div id="price-model-row">
                <label for="price-model" id="price-model-label">ä»·æ ¼æ¨¡å‹ï¼ˆä»…æ–¹å¼1ï¼‰</label>
                <input type="text" id="price-model" value="" placeholder="ç•™ç©ºä½¿ç”¨é»˜è®¤ä»·æ ¼æ¨¡å‹" />
              </div> -->
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <button id="submit-btn">
                <span id="button-text">å¼€å§‹è¯†åˆ«</span>
              </button>
              <button class="secondary" id="clear-files-btn">æ¸…ç©ºå›¾ç‰‡</button>
            </div>

            <!-- è¿›åº¦æ˜¾ç¤º -->
            <div id="progress-section" style="display: none;">
              <label id="progress-label">å¤„ç†è¿›åº¦</label>
              <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 8px;">
                <span id="progress-text">0 / 0</span>
                <span id="progress-percent">0%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
              </div>
            </div>
          </div>

          <div class="card grid hidden" id="title-card">
            <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px;">
              <h2 id="title-card-heading" style="margin: 0; font-size: 18px;">å•†å“æ ‡é¢˜åˆ†ç±»æµ‹è¯•</h2>
              <span class="pill" id="title-card-pill">NEW</span>
            </div>

            <div class="controls-row">
              <div>
                <label for="title-input" id="title-input-label">å•†å“æ ‡é¢˜</label>
                <input type="text" id="title-input" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" />
              </div>
              <div>
                <label for="title-language" id="title-language-label">æ ‡é¢˜è¯­è¨€</label>
                <select id="title-language">
                  <option value="ja" selected id="title-lang-ja">æ—¥è¯­</option>
                  <option value="en" id="title-lang-en">è‹±è¯­</option>
                  <option value="zh" id="title-lang-zh">ä¸­æ–‡</option>
                </select>
              </div>
            </div>

            <div class="controls-row">
              <div>
                <label for="image-url" id="image-url-label">å›¾ç‰‡ URLï¼ˆå¯é€‰ï¼Œç”¨äºå…œåº•ï¼‰</label>
                <input type="text" id="image-url" placeholder="https://example.com/item.jpg" />
              </div>
              <div>
                <label for="title-api-endpoint" id="title-api-label">æ¥å£åœ°å€</label>
                <input
                  type="text"
                  id="title-api-endpoint"
                  value=""
                  placeholder="é»˜è®¤ /api/v1/mercari/title/analyze"
                />
              </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <button id="title-submit-btn">
                <span id="title-button-text">å‘é€è¯·æ±‚</span>
              </button>
              <button class="secondary" id="title-clear-btn">é‡ç½®</button>
            </div>

            <div class="results-section" style="margin-top: 10px;">
              <h3 id="title-result-heading" style="margin: 0 0 8px 0;">åˆ†ç±»ç»“æœ</h3>
              <div id="title-result"></div>
            </div>
          </div>

          <!-- ç»“æœåˆ—è¡¨ -->
          <div class="results-section" id="image-results-section">
            <h2 id="results-title" style="margin: 0 0 12px 0; font-size: 18px;">è¯†åˆ«ç»“æœ</h2>
            <div id="results-list"></div>
          </div>
        </div>

        <!-- å³ä¾§ç»Ÿè®¡é¢æ¿ -->
        <div class="stats-panel">
          <div class="card">
            <div class="stats-header">
              <h2 id="stats-title">æµ‹è¯•ç»Ÿè®¡</h2>
              <button class="clear-btn" id="clear-stats-btn">æ¸…ç©º</button>
            </div>

            <div class="stat-card">
              <div class="stat-label" id="total-tests-label">æ€»æµ‹è¯•æ¬¡æ•°</div>
              <div class="stat-value" id="total-count">0</div>
            </div>

            <div class="stat-breakdown">
              <div class="stat-item accurate">
                <span class="stat-item-label" id="accurate-label">âœ… å‡†ç¡®</span>
                <div>
                  <span class="stat-item-value" id="accurate-count">0</span>
                  <span class="stat-item-percent" id="accurate-percent">0%</span>
                </div>
              </div>
              <div class="stat-item moderate">
                <span class="stat-item-label" id="moderate-label">âš ï¸ ä¸€èˆ¬</span>
                <div>
                  <span class="stat-item-value" id="moderate-count">0</span>
                  <span class="stat-item-percent" id="moderate-percent">0%</span>
                </div>
              </div>
              <div class="stat-item inaccurate">
                <span class="stat-item-label" id="inaccurate-label">âŒ é”™è¯¯</span>
                <div>
                  <span class="stat-item-value" id="inaccurate-count">0</span>
                  <span class="stat-item-percent" id="inaccurate-percent">0%</span>
                </div>
              </div>
            </div>

            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border);">
              <div class="stat-label" id="accuracy-label">å‡†ç¡®ç‡</div>
              <div class="stat-value" style="font-size: 24px; color: var(--success);" id="accuracy-rate">--</div>
            </div>
          </div>

          <div class="card" style="margin-top: 12px;">
            <div class="stats-header">
              <h2 id="api-title">æ¥å£åœ°å€</h2>
            </div>
            <input
              type="text"
              id="api-endpoint"
              value=""
              placeholder="è¯·è¾“å…¥APIåœ°å€ï¼Œé»˜è®¤ /api/v1/mercari/image/analyze"
            />
          </div>
        </div>
      </div>
    </div>

    <script>
      const translations = {
        zh: {
          documentTitle: "Mercari å•†å“å›¾ç‰‡è¯†åˆ«æµ‹è¯•",
          pageTitle: "Mercari å•†å“å›¾ç‰‡è¯†åˆ«æµ‹è¯•",
          betaPill: "æ‰¹é‡æµ‹è¯•ç‰ˆ",
          uiLanguageLabel: "ç•Œé¢è¯­è¨€",
          uiLangZh: "ä¸­æ–‡",
          uiLangJa: "æ—¥è¯­",
          statusIdle: "å¾…å‘½",
          statusProcessing: "æ‰¹é‡å¤„ç†ä¸­...",
          statusDone: "å®Œæˆ",
          uploadLabel: "å•†å“å›¾ç‰‡ï¼ˆæ”¯æŒæ‰¹é‡ä¸Šä¼ ï¼‰",
          uploadText: "ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„",
          uploadHint: "æ”¯æŒå¤šé€‰ï¼ŒJPGã€PNGã€GIF ç­‰æ ¼å¼",
          previewLabel: "å·²é€‰æ‹© {count} å¼ å›¾ç‰‡",
          outputLanguageLabel: "æ ‡é¢˜/æè¿°è¯­è¨€",
          outputLangJa: "æ—¥è¯­",
          outputLangEn: "è‹±è¯­",
          outputLangZh: "ç®€ä½“ä¸­æ–‡",
          categoryCountLabel: "è¿”å›ç±»åˆ«ä¸ªæ•°",
          priceStrategyLabel: "ä»·æ ¼ç­–ç•¥",
          priceStrategyVision: "é»˜è®¤(æ¨ç†)",
          priceStrategyDedicated: "ç‹¬ç«‹æ¨¡å‹+æœç´¢(ä¼˜å…ˆç²¾åº¦)",
          priceStrategyVisionOnline: "æœç´¢æ¨¡å¼(é€Ÿåº¦è¾ƒæ…¢)",
          visionModelLabel: "è§†è§‰æ¨¡å‹",
          visionModelPlaceholder: "ç•™ç©ºä½¿ç”¨é»˜è®¤è§†è§‰æ¨¡å‹",
          categoryModelLabel: "åˆ†ç±»æ¨¡å‹",
          categoryModelPlaceholder: "ç•™ç©ºä½¿ç”¨é»˜è®¤åˆ†ç±»æ¨¡å‹",
          priceModelLabel: "ä»·æ ¼æ¨¡å‹",
          priceModelPlaceholder: "ç•™ç©ºä½¿ç”¨é»˜è®¤ä»·æ ¼æ¨¡å‹",
          startButton: "å¼€å§‹è¯†åˆ«",
          clearImages: "æ¸…ç©ºå›¾ç‰‡",
          progressLabel: "å¤„ç†è¿›åº¦",
          resultsTitle: "è¯†åˆ«ç»“æœ",
          statsTitle: "æµ‹è¯•ç»Ÿè®¡",
          clearStats: "æ¸…ç©º",
          totalTestsLabel: "æ€»æµ‹è¯•æ¬¡æ•°",
          statAccurate: "âœ… å‡†ç¡®",
          statModerate: "âš ï¸ ä¸€èˆ¬",
          statInaccurate: "âŒ é”™è¯¯",
          accuracyLabel: "å‡†ç¡®ç‡",
          apiTitle: "æ¥å£åœ°å€",
          apiPlaceholder: "è¯·è¾“å…¥APIåœ°å€ï¼Œé»˜è®¤ /api/v1/mercari/image/analyze",
          alertNoFiles: "è¯·å…ˆé€‰æ‹©å›¾ç‰‡",
          alertNoEndpoint: "è¯·å¡«å†™æ¥å£åœ°å€",
          processingButton: "å¤„ç†ä¸­...",
          statusBadgeProcessing: "å¤„ç†ä¸­...",
          badgeSuccess: "âœ“ å®Œæˆ",
          badgeFail: "âœ— å¤±è´¥",
          badgeError: "âœ— é”™è¯¯",
          statusProcessingText: "æ‰¹é‡å¤„ç†ä¸­...",
          statusDoneText: "å®Œæˆ",
          resultSuccess: "æˆåŠŸ",
          resultFail: "å¤±è´¥",
          fieldTitle: "ğŸ“ æ ‡é¢˜",
          fieldDescription: "ğŸ“„ æè¿°",
          fieldCategory: "ğŸ·ï¸ åˆ†ç±»",
          fieldCategoryCandidates: "ğŸ·ï¸ åˆ†ç±»å€™é€‰",
          unknownCategory: "æœªçŸ¥åˆ†ç±»",
          fieldBrand: "ğŸ”– å“ç‰Œ",
          unknownBrand: "æœªçŸ¥å“ç‰Œ",
          fieldPriceSingle: "ğŸ’° å»ºè®®ä»·æ ¼",
          fieldPriceList: "ğŸ’° ä»·æ ¼é¢„æµ‹",
          priceCandidateLabel: "å€™é€‰",
          priceNone: "æš‚æ— ä»·æ ¼",
          priceFailed: "é¢„æµ‹å¤±è´¥æˆ–æ— ç»“æœ",
          priceRefs: "ğŸ”— ä»·æ ¼æœç´¢å¼•ç”¨",
          priceRefFallback: "å‚è€ƒ",
          fieldCondition: "ğŸ“¦ å•†å“çŠ¶æ€",
          fieldShipping: "ğŸšš é…é€æ–¹å¼",
          noStructuredData: "æ— ç»“æ„åŒ–æ•°æ®",
          toggleShowJson: "æŸ¥çœ‹åŸå§‹ JSON",
          toggleHideJson: "éšè—åŸå§‹ JSON",
          tabImage: "å›¾ç‰‡è¯†åˆ«",
          tabTitle: "æ ‡é¢˜åˆ†ç±»",
          ratingLabel: "è¯„ä»·è¯†åˆ«ç»“æœï¼š",
          ratingAccurate: "âœ… å‡†ç¡®",
          ratingModerate: "âš ï¸ ä¸€èˆ¬",
          ratingInaccurate: "âŒ é”™è¯¯",
          confirmClearStats: "ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æµ‹è¯•ç»Ÿè®¡æ•°æ®å—ï¼Ÿ",
          warnDefaults: "æ— æ³•è·å–é»˜è®¤æ¨¡å‹",
          jsonParseFailed: "JSON parse failed",
          titleCardHeading: "å•†å“æ ‡é¢˜åˆ†ç±»æµ‹è¯•",
          titleCardPill: "æ ‡é¢˜â†’åˆ†ç±»",
          titleInputLabel: "å•†å“æ ‡é¢˜",
          titleInputPlaceholder: "è¯·è¾“å…¥å•†å“æ ‡é¢˜",
          titleLanguageLabel: "æ ‡é¢˜è¯­è¨€",
          titleImageUrlLabel: "å›¾ç‰‡ URLï¼ˆå¯é€‰ï¼Œç”¨äºå…œåº•ï¼‰",
          titleImageUrlPlaceholder: "https://example.com/item.jpg",
          titleApiLabel: "æ¥å£åœ°å€",
          titleApiPlaceholder: "é»˜è®¤ /api/v1/mercari/title/analyze",
          titleSubmitButton: "å‘é€è¯·æ±‚",
          titleProcessingButton: "è¯·æ±‚ä¸­...",
          titleClearButton: "é‡ç½®",
          titleResultHeading: "åˆ†ç±»ç»“æœ",
          titleBestPath: "ğŸ·ï¸ æœ€ä½³åˆ†ç±»è·¯å¾„",
          titleAlternatives: "å€™é€‰åˆ†ç±»è·¯å¾„",
          titleNoAlternatives: "æš‚æ— å€™é€‰",
          alertNoTitle: "è¯·å¡«å†™å•†å“æ ‡é¢˜",
          titleError: "è¯·æ±‚å¤±è´¥"
        },
        ja: {
          documentTitle: "ãƒ¡ãƒ«ã‚«ãƒªå•†å“ç”»åƒè­˜åˆ¥ãƒ†ã‚¹ã‚¿ãƒ¼",
          pageTitle: "ãƒ¡ãƒ«ã‚«ãƒªå•†å“ç”»åƒè­˜åˆ¥ãƒ†ã‚¹ãƒˆ",
          betaPill: "ãƒãƒƒãƒãƒ†ã‚¹ãƒˆç‰ˆ",
          uiLanguageLabel: "UIè¨€èª",
          uiLangZh: "ä¸­å›½èª",
          uiLangJa: "æ—¥æœ¬èª",
          statusIdle: "å¾…æ©Ÿä¸­",
          statusProcessing: "ä¸€æ‹¬å‡¦ç†ä¸­...",
          statusDone: "å®Œäº†",
          uploadLabel: "å•†å“ç”»åƒï¼ˆè¤‡æ•°ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯¾å¿œï¼‰",
          uploadText: "ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—",
          uploadHint: "è¤‡æ•°é¸æŠå¯ã€‚JPG/PNG/GIF ãªã©ã«å¯¾å¿œ",
          previewLabel: "é¸æŠä¸­ {count} æš",
          outputLanguageLabel: "ã‚¿ã‚¤ãƒˆãƒ«/èª¬æ˜ã®è¨€èª",
          outputLangJa: "æ—¥æœ¬èª",
          outputLangEn: "è‹±èª",
          outputLangZh: "ä¸­å›½èªï¼ˆç°¡ä½“å­—ï¼‰",
          categoryCountLabel: "è¿”å´ã™ã‚‹ã‚«ãƒ†ã‚´ãƒªæ•°",
          priceStrategyLabel: "ä¾¡æ ¼ãƒ¢ãƒ¼ãƒ‰",
          priceStrategyVision: "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ(æ¨ç†)",
          priceStrategyDedicated: "ç‹¬ç«‹æ¨¡å‹+æ¤œç´¢(å„ªå…ˆç²¾åº¦)",
          priceStrategyVisionOnline: "æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰(é€Ÿåº¦è¼ƒé…)",
          visionModelLabel: "ãƒ“ã‚¸ãƒ§ãƒ³ãƒ¢ãƒ‡ãƒ«",
          visionModelPlaceholder: "ç©ºæ¬„ãªã‚‰æ—¢å®šãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨",
          categoryModelLabel: "ã‚«ãƒ†ã‚´ãƒªãƒ¢ãƒ‡ãƒ«",
          categoryModelPlaceholder: "ç©ºæ¬„ãªã‚‰æ—¢å®šãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨",
          priceModelLabel: "ä¾¡æ ¼ãƒ¢ãƒ‡ãƒ«",
          priceModelPlaceholder: "ç©ºæ¬„ãªã‚‰æ—¢å®šãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨",
          startButton: "è§£æã‚’é–‹å§‹",
          clearImages: "ç”»åƒã‚’ã‚¯ãƒªã‚¢",
          progressLabel: "å‡¦ç†é€²æ—",
          resultsTitle: "è§£æçµæœ",
          statsTitle: "ãƒ†ã‚¹ãƒˆçµ±è¨ˆ",
          clearStats: "ãƒªã‚»ãƒƒãƒˆ",
          totalTestsLabel: "ãƒ†ã‚¹ãƒˆåˆè¨ˆå›æ•°",
          statAccurate: "âœ… æ­£ç¢º",
          statModerate: "âš ï¸ æ™®é€š",
          statInaccurate: "âŒ èª¤ã‚Š",
          accuracyLabel: "æ­£ç¢ºç‡",
          apiTitle: "API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ",
          apiPlaceholder: "API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å…¥åŠ›ï¼ˆæ—¢å®š: /api/v1/mercari/image/analyzeï¼‰",
          alertNoFiles: "ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„",
          alertNoEndpoint: "API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
          processingButton: "å‡¦ç†ä¸­...",
          statusBadgeProcessing: "å‡¦ç†ä¸­...",
          badgeSuccess: "âœ“ å®Œäº†",
          badgeFail: "âœ— å¤±æ•—",
          badgeError: "âœ— ã‚¨ãƒ©ãƒ¼",
          statusProcessingText: "ä¸€æ‹¬å‡¦ç†ä¸­...",
          statusDoneText: "å®Œäº†",
          resultSuccess: "æˆåŠŸ",
          resultFail: "å¤±æ•—",
          fieldTitle: "ğŸ“ ã‚¿ã‚¤ãƒˆãƒ«",
          fieldDescription: "ğŸ“„ èª¬æ˜",
          fieldCategory: "ğŸ·ï¸ ã‚«ãƒ†ã‚´ãƒª",
          fieldCategoryCandidates: "ğŸ·ï¸ ã‚«ãƒ†ã‚´ãƒªå€™è£œ",
          unknownCategory: "ä¸æ˜ãªã‚«ãƒ†ã‚´ãƒª",
          fieldBrand: "ğŸ”– ãƒ–ãƒ©ãƒ³ãƒ‰",
          unknownBrand: "ä¸æ˜ãƒ–ãƒ©ãƒ³ãƒ‰",
          fieldPriceSingle: "ğŸ’° æ¨å¥¨ä¾¡æ ¼",
          fieldPriceList: "ğŸ’° ä¾¡æ ¼äºˆæ¸¬",
          priceCandidateLabel: "å€™è£œ",
          priceNone: "ä¾¡æ ¼ãªã—",
          priceFailed: "ä¾¡æ ¼äºˆæ¸¬ã«å¤±æ•—ã¾ãŸã¯ãªã—",
          priceRefs: "ğŸ”— ä¾¡æ ¼æ¤œç´¢ã®å‚ç…§",
          priceRefFallback: "å‚ç…§",
          fieldCondition: "ğŸ“¦ å•†å“çŠ¶æ…‹",
          fieldShipping: "ğŸšš é…é€æ–¹æ³•",
          noStructuredData: "æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ãªã—",
          toggleShowJson: "å…ƒã® JSON ã‚’è¡¨ç¤º",
          toggleHideJson: "JSON ã‚’éš ã™",
          tabImage: "ç”»åƒè§£æ",
          tabTitle: "ã‚¿ã‚¤ãƒˆãƒ«åˆ†é¡",
          ratingLabel: "è§£æçµæœã‚’è©•ä¾¡ï¼š",
          ratingAccurate: "âœ… æ­£ç¢º",
          ratingModerate: "âš ï¸ æ™®é€š",
          ratingInaccurate: "âŒ èª¤ã‚Š",
          confirmClearStats: "çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ",
          warnDefaults: "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ‡ãƒ«ã‚’å–å¾—ã§ãã¾ã›ã‚“",
          jsonParseFailed: "JSON ã®ãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ã¾ã—ãŸ",
          titleCardHeading: "å•†å“ã‚¿ã‚¤ãƒˆãƒ«åˆ†é¡ãƒ†ã‚¹ãƒˆ",
          titleCardPill: "ã‚¿ã‚¤ãƒˆãƒ«â†’åˆ†é¡",
          titleInputLabel: "å•†å“ã‚¿ã‚¤ãƒˆãƒ«",
          titleInputPlaceholder: "å•†å“ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
          titleLanguageLabel: "ã‚¿ã‚¤ãƒˆãƒ«ã®è¨€èª",
          titleImageUrlLabel: "ç”»åƒURLï¼ˆä»»æ„ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰",
          titleImageUrlPlaceholder: "https://example.com/item.jpg",
          titleApiLabel: "API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ",
          titleApiPlaceholder: "æ—¢å®š /api/v1/mercari/title/analyze",
          titleSubmitButton: "ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡",
          titleProcessingButton: "é€ä¿¡ä¸­...",
          titleClearButton: "ãƒªã‚»ãƒƒãƒˆ",
          titleResultHeading: "åˆ†é¡çµæœ",
          titleBestPath: "ğŸ·ï¸ æœ€é©ãªã‚«ãƒ†ã‚´ãƒª",
          titleAlternatives: "ä»£æ›¿ã‚«ãƒ†ã‚´ãƒª",
          titleNoAlternatives: "ä»£æ›¿ã‚«ãƒ†ã‚´ãƒªãªã—",
          alertNoTitle: "å•†å“ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
          titleError: "ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ"
        }
      };

      let uiLanguage = localStorage.getItem("mercari_ui_lang") || "zh";

      function t(key, params) {
        const pack = translations[uiLanguage] || translations.zh;
        const fallback = translations.zh;
        const template = pack[key] || fallback[key] || key;
        if (!params) return template;
        return template.replace(/\{(\w+)\}/g, (_, k) => (params[k] !== undefined ? params[k] : ""));
      }

      let statusState = "idle";

      function setStatus(state) {
        statusState = state;
        const statusKey = state === "processing" ? "statusProcessing" : state === "done" ? "statusDone" : "statusIdle";
        statusText.textContent = t(statusKey);
        if (state === "processing") {
          statusDot.classList.add("live");
        } else {
          statusDot.classList.remove("live");
        }
      }

      // å…¨å±€çŠ¶æ€
      let selectedFiles = [];
      let testResults = [];
      let processing = false;
      let resultRatings = {}; // è·Ÿè¸ªæ¯ä¸ªç»“æœçš„è¯„ä»·çŠ¶æ€ { resultId: 'accurate' | 'moderate' | 'inaccurate' | null }
      let titleProcessing = false;
      let activeTab = "image";

      // DOM å…ƒç´ 
      const pageTitleEl = document.getElementById("page-title");
      const betaPill = document.getElementById("beta-pill");
      const uiLanguageSelect = document.getElementById("ui-language");
      const imageInput = document.getElementById("image");
      const uploadArea = document.getElementById("upload-area");
      const previewContainer = document.getElementById("preview-container");
      const previewGrid = document.getElementById("preview-grid");
      const uploadLabel = document.getElementById("upload-label");
      const uploadText = document.getElementById("upload-text");
      const uploadHint = document.getElementById("upload-hint");
      const previewLabel = document.getElementById("preview-label");
      const fileCount = document.getElementById("file-count");
      const languageSelect = document.getElementById("language");
      const langOptJa = document.getElementById("lang-opt-ja");
      const langOptEn = document.getElementById("lang-opt-en");
      const langOptZh = document.getElementById("lang-opt-zh");
      const outputLanguageLabel = document.getElementById("output-language-label");
      const categoryCountLabel = document.getElementById("category-count-label");
      const categoryCountSelect = document.getElementById("category-count");
      const priceStrategyLabel = document.getElementById("price-strategy-label");
      const priceStrategySelect = document.getElementById("price-strategy");
      const priceStrategyDefault = document.getElementById("price-strategy-default");
      const priceStrategyOnline = document.getElementById("price-strategy-online");
      const priceStrategyDedicated = document.getElementById("price-strategy-dedicated");
      // const visionModelLabel = document.getElementById("vision-model-label");
      // const categoryModelLabel = document.getElementById("category-model-label");
      // const priceModelLabel = document.getElementById("price-model-label");
      const visionModelInput = document.getElementById("vision-model");
      const categoryModelInput = document.getElementById("category-model");
      const priceModelInput = document.getElementById("price-model");
      // const priceModelRow = document.getElementById("price-model-row");
      const apiInput = document.getElementById("api-endpoint");
      const submitBtn = document.getElementById("submit-btn");
      const buttonText = document.getElementById("button-text");
      const clearFilesBtn = document.getElementById("clear-files-btn");
      const progressSection = document.getElementById("progress-section");
      const progressLabel = document.getElementById("progress-label");
      const progressText = document.getElementById("progress-text");
      const progressPercent = document.getElementById("progress-percent");
      const progressFill = document.getElementById("progress-fill");
      const resultsList = document.getElementById("results-list");
      const resultsTitle = document.getElementById("results-title");
      const statusText = document.getElementById("status-text");
      const statusDot = document.getElementById("status-dot");
      const clearStatsBtn = document.getElementById("clear-stats-btn");
      const statsTitle = document.getElementById("stats-title");
      const totalTestsLabel = document.getElementById("total-tests-label");
      const accurateLabel = document.getElementById("accurate-label");
      const moderateLabel = document.getElementById("moderate-label");
      const inaccurateLabel = document.getElementById("inaccurate-label");
      const accuracyLabel = document.getElementById("accuracy-label");
      const tabImageBtn = document.getElementById("tab-image");
      const tabTitleBtn = document.getElementById("tab-title");
      const imageCard = document.getElementById("image-card");
      const titleCard = document.getElementById("title-card");
      const imageResultsSection = document.getElementById("image-results-section");
      const apiTitle = document.getElementById("api-title");

      // ç»Ÿè®¡å…ƒç´ 
      const totalCountEl = document.getElementById("total-count");
      const accurateCountEl = document.getElementById("accurate-count");
      const accuratePercentEl = document.getElementById("accurate-percent");
      const moderateCountEl = document.getElementById("moderate-count");
      const moderatePercentEl = document.getElementById("moderate-percent");
      const inaccurateCountEl = document.getElementById("inaccurate-count");
      const inaccuratePercentEl = document.getElementById("inaccurate-percent");
      const accuracyRateEl = document.getElementById("accuracy-rate");
      const titleCardHeading = document.getElementById("title-card-heading");
      const titleCardPill = document.getElementById("title-card-pill");
      const titleInputLabel = document.getElementById("title-input-label");
      const titleInput = document.getElementById("title-input");
      const titleLanguageLabel = document.getElementById("title-language-label");
      const titleLanguageSelect = document.getElementById("title-language");
      const titleLangJa = document.getElementById("title-lang-ja");
      const titleLangEn = document.getElementById("title-lang-en");
      const titleLangZh = document.getElementById("title-lang-zh");
      const titleImageUrlLabel = document.getElementById("image-url-label");
      const titleImageUrlInput = document.getElementById("image-url");
      const titleApiLabel = document.getElementById("title-api-label");
      const titleApiInput = document.getElementById("title-api-endpoint");
      const titleSubmitBtn = document.getElementById("title-submit-btn");
      const titleButtonText = document.getElementById("title-button-text");
      const titleClearBtn = document.getElementById("title-clear-btn");
      const titleResultHeading = document.getElementById("title-result-heading");
      const titleResult = document.getElementById("title-result");

      // LocalStorage ç®¡ç†
      const STORAGE_KEY = "mercari_test_stats";

      function updatePreviewLabel() {
        previewLabel.innerHTML = t("previewLabel", { count: fileCount.textContent || "0" });
      }

      function applyTranslations() {
        document.documentElement.lang = uiLanguage === "ja" ? "ja" : "zh";
        document.title = t("documentTitle");
        pageTitleEl.textContent = t("pageTitle");
        betaPill.textContent = t("betaPill");
        uiLanguageSelect.value = uiLanguage;
        uiLanguageSelect.querySelector('option[value="zh"]').textContent = t("uiLangZh");
        uiLanguageSelect.querySelector('option[value="ja"]').textContent = t("uiLangJa");

        uploadLabel.textContent = t("uploadLabel");
        uploadText.textContent = t("uploadText");
        uploadHint.textContent = t("uploadHint");
        updatePreviewLabel();

        outputLanguageLabel.textContent = t("outputLanguageLabel");
        langOptJa.textContent = t("outputLangJa");
        langOptEn.textContent = t("outputLangEn");
        langOptZh.textContent = t("outputLangZh");
        categoryCountLabel.textContent = t("categoryCountLabel");
        priceStrategyLabel.textContent = t("priceStrategyLabel");
        priceStrategyDefault.textContent = t("priceStrategyVision");
        priceStrategyOnline.textContent = t("priceStrategyVisionOnline");
        priceStrategyDedicated.textContent = t("priceStrategyDedicated");
        // visionModelLabel.textContent = t("visionModelLabel");
        // visionModelInput.placeholder = t("visionModelPlaceholder");
        // categoryModelLabel.textContent = t("categoryModelLabel");
        // categoryModelInput.placeholder = t("categoryModelPlaceholder");
        // priceModelLabel.textContent = t("priceModelLabel");
        // priceModelInput.placeholder = t("priceModelPlaceholder");

        buttonText.innerHTML = processing
          ? `<span class="spinner"></span> ${t("processingButton")}`
          : t("startButton");
        clearFilesBtn.textContent = t("clearImages");
        progressLabel.textContent = t("progressLabel");
        resultsTitle.textContent = t("resultsTitle");

        statsTitle.textContent = t("statsTitle");
        clearStatsBtn.textContent = t("clearStats");
        totalTestsLabel.textContent = t("totalTestsLabel");
        accurateLabel.textContent = t("statAccurate");
        moderateLabel.textContent = t("statModerate");
        inaccurateLabel.textContent = t("statInaccurate");
        accuracyLabel.textContent = t("accuracyLabel");

        apiTitle.textContent = t("apiTitle");
        apiInput.placeholder = t("apiPlaceholder");
        tabImageBtn.textContent = t("tabImage");
        tabTitleBtn.textContent = t("tabTitle");

        titleCardHeading.textContent = t("titleCardHeading");
        titleCardPill.textContent = t("titleCardPill");
        titleInputLabel.textContent = t("titleInputLabel");
        titleInput.placeholder = t("titleInputPlaceholder");
        titleLanguageLabel.textContent = t("titleLanguageLabel");
        titleLangJa.textContent = t("outputLangJa");
        titleLangEn.textContent = t("outputLangEn");
        titleLangZh.textContent = t("outputLangZh");
        titleImageUrlLabel.textContent = t("titleImageUrlLabel");
        titleImageUrlInput.placeholder = t("titleImageUrlPlaceholder");
        titleApiLabel.textContent = t("titleApiLabel");
        titleApiInput.placeholder = t("titleApiPlaceholder");
        titleButtonText.textContent = titleProcessing ? t("titleProcessingButton") : t("titleSubmitButton");
        titleClearBtn.textContent = t("titleClearButton");
        titleResultHeading.textContent = t("titleResultHeading");

        setStatus(statusState);
        setActiveTab(activeTab);
        renderResults();
      }

      function loadStats() {
        const data = localStorage.getItem(STORAGE_KEY);
        return data ? JSON.parse(data) : { accurate: 0, moderate: 0, inaccurate: 0, history: [] };
      }

      function saveStats(stats) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(stats));
        updateStatsDisplay();
      }

      function updateStatsDisplay() {
        const stats = loadStats();
        const total = stats.accurate + stats.moderate + stats.inaccurate;
        
        totalCountEl.textContent = total;
        accurateCountEl.textContent = stats.accurate;
        moderateCountEl.textContent = stats.moderate;
        inaccurateCountEl.textContent = stats.inaccurate;
        
        if (total > 0) {
          const accuratePercent = ((stats.accurate / total) * 100).toFixed(1);
          const moderatePercent = ((stats.moderate / total) * 100).toFixed(1);
          const inaccuratePercent = ((stats.inaccurate / total) * 100).toFixed(1);
          
          accuratePercentEl.textContent = `${accuratePercent}%`;
          moderatePercentEl.textContent = `${moderatePercent}%`;
          inaccuratePercentEl.textContent = `${inaccuratePercent}%`;
          accuracyRateEl.textContent = `${accuratePercent}%`;
        } else {
          accuratePercentEl.textContent = "0%";
          moderatePercentEl.textContent = "0%";
          inaccuratePercentEl.textContent = "0%";
          accuracyRateEl.textContent = "--";
        }
      }

      function recordRating(resultId, newRating) {
        const stats = loadStats();
        const oldRating = resultRatings[resultId];
        
        // å¦‚æœä¹‹å‰æœ‰è¯„ä»·ï¼Œå…ˆå‡å»
        if (oldRating) {
          stats[oldRating]--;
        }
        
        // æ·»åŠ æ–°è¯„ä»·
        stats[newRating]++;
        resultRatings[resultId] = newRating;
        
        // ä¿å­˜å†å²è®°å½•
        stats.history.push({ 
          resultId,
          rating: newRating, 
          oldRating: oldRating || null,
          timestamp: Date.now() 
        });
        
        saveStats(stats);
      }

      // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
      function formatBytes(bytes) {
        const units = ["B", "KB", "MB"];
        let size = bytes;
        let i = 0;
        while (size >= 1024 && i < units.length - 1) {
          size /= 1024;
          i++;
        }
        return `${size.toFixed(size >= 10 ? 0 : 1)} ${units[i]}`;
      }

      // æ ¼å¼åŒ–ç»“æœæ•°æ®ï¼ˆç»“æ„åŒ–å±•ç¤ºï¼‰
      function formatResultData(payload) {
        if (payload.error) {
          return `<div class="field-value" style="color: var(--danger);">âŒ ${payload.error}</div>`;
        }

        const data = payload.data || payload;
        let html = '';

        // æ ‡é¢˜
        if (data.title) {
          html += `
            <div class="field-group">
              <div class="field-label">${t("fieldTitle")}</div>
              <div class="field-value large">${escapeHtml(data.title)}</div>
            </div>
          `;
        }

        // æè¿°
        if (data.description) {
          html += `
            <div class="field-group">
              <div class="field-label">${t("fieldDescription")}</div>
              <div class="field-value">${escapeHtml(data.description)}</div>
            </div>
          `;
        }

        // åˆ†ç±»ï¼ˆå•ä¸ªï¼‰
        if (data.category_id || data.category_name) {
          html += `
            <div class="field-group">
              <div class="field-label">${t("fieldCategory")}</div>
              <div class="tags-container">
                ${data.category_name ? `<span class="tag primary">${escapeHtml(data.category_name)}</span>` : ''}
                ${data.category_id ? `<span class="tag">ID: ${escapeHtml(String(data.category_id))}</span>` : ''}
              </div>
            </div>
          `;
        }

        // åˆ†ç±»åˆ—è¡¨ï¼ˆå¤šä¸ªå€™é€‰ï¼‰
        if (data.categories && Array.isArray(data.categories) && data.categories.length > 0) {
          html += `
            <div class="field-group">
              <div class="field-label">${t("fieldCategoryCandidates")} (${data.categories.length})</div>
              <div class="tags-container">
                ${data.categories.map((cat, index) => {
                  const name = cat.name || cat.category_name || t("unknownCategory");
                  const id = cat.id || cat.category_id || '';
                  const confidence = cat.confidence || cat.score;
                  const isPrimary = index === 0 ? 'primary' : '';
                  
                  let label = escapeHtml(name);
                  if (id) label += ` (ID: ${escapeHtml(String(id))})`;
                  if (confidence !== undefined) {
                    const confidencePercent = (confidence * 100).toFixed(1);
                    label += ` - ${confidencePercent}%`;
                  }
                  
                  return `<span class="tag ${isPrimary}">${label}</span>`;
                }).join('')}
              </div>
            </div>
          `;
        }

        // å“ç‰Œ
        if (data.brand_id || data.brand_name) {
          const brandName = data.brand_name ? escapeHtml(data.brand_name) : t("unknownBrand");
          const brandId = data.brand_id ? escapeHtml(String(data.brand_id)) : "";
          const brandLabel = brandId ? `${brandName} (ID: ${brandId})` : brandName;
          html += `
            <div class="field-group">
              <div class="field-label">${t("fieldBrand")}</div>
              <div class="tags-container">
                <span class="tag primary">${brandLabel}</span>
              </div>
            </div>
          `;
        }

        // ä»·æ ¼ï¼ˆå•ä¸ªï¼‰
        if (data.price !== undefined && data.price !== null) {
          html += `
            <div class="field-group">
              <div class="field-label">${t("fieldPriceSingle")}</div>
              <div class="field-value">Â¥${escapeHtml(String(data.price))}</div>
            </div>
          `;
        }

        // ä»·æ ¼åˆ—è¡¨ï¼ˆæœ€å¯èƒ½çš„3ä¸ªä»·æ ¼ï¼Œå·²æŒ‰å¯èƒ½æ€§æ’åºï¼‰
        if (Array.isArray(data.prices) && data.prices.length) {
          const priceTags = data.prices
            .map((p, idx) => {
              if (p === null || p === undefined) return null;
              return `<span class="tag ${idx === 0 ? 'primary' : ''}">${t("priceCandidateLabel")}${idx + 1}: Â¥${escapeHtml(String(p))}</span>`;
            })
            .filter(Boolean)
            .join("");

          html += `
            <div class="field-group">
              <div class="field-label">${t("fieldPriceList")}</div>
              <div class="tags-container">
                ${priceTags || `<span class="tag">${t("priceNone")}</span>`}
              </div>
            </div>
          `;
        } else {
          html += `
            <div class="field-group">
              <div class="field-label">${t("fieldPriceList")}</div>
              <div class="field-value" style="color: var(--danger);">${t("priceFailed")}</div>
            </div>
          `;
        }

        // ä»·æ ¼å¼•ç”¨é“¾æ¥
        if (Array.isArray(data.price_citations) && data.price_citations.length) {
          const links = data.price_citations
            .map((c, idx) => {
              const url = c.url || "";
              const title = c.title || getHostname(url) || `${t("priceRefFallback")}${idx + 1}`;
              return `<li><a href="${escapeHtml(url)}" target="_blank" rel="noopener noreferrer">${escapeHtml(title)}</a></li>`;
            })
            .join("");
          html += `
            <div class="field-group">
              <div class="field-label">${t("priceRefs")}</div>
              <ul style="padding-left: 18px; margin: 6px 0; color: var(--accent);">
                ${links}
              </ul>
            </div>
          `;
        }

        // å•†å“çŠ¶æ€
        if (data.item_condition_id || data.item_condition) {
          html += `
            <div class="field-group">
              <div class="field-label">${t("fieldCondition")}</div>
              <div class="tags-container">
                ${data.item_condition ? `<span class="tag">${escapeHtml(String(data.item_condition))}</span>` : ''}
                ${data.item_condition_id ? `<span class="tag">ID: ${escapeHtml(String(data.item_condition_id))}</span>` : ''}
              </div>
            </div>
          `;
        }

        // é…é€æ–¹å¼
        if (data.shipping_method) {
          html += `
            <div class="field-group">
              <div class="field-label">${t("fieldShipping")}</div>
              <div class="field-value">${escapeHtml(String(data.shipping_method))}</div>
            </div>
          `;
        }

        return html || `<div class="field-value">${t("noStructuredData")}</div>`;
      }
      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      function getHostname(url) {
        try {
          return new URL(url).hostname.replace(/^www\./, '');
        } catch (e) {
          return '';
        }
      }

      function setActiveTab(tab) {
        activeTab = tab === "title" ? "title" : "image";
        tabImageBtn.classList.toggle("active", activeTab === "image");
        tabTitleBtn.classList.toggle("active", activeTab === "title");
        imageCard.classList.toggle("hidden", activeTab !== "image");
        imageResultsSection.classList.toggle("hidden", activeTab !== "image");
        titleCard.classList.toggle("hidden", activeTab !== "title");
      }

      function renderTitleResult(payload, success) {
        if (!payload) {
          titleResult.innerHTML = "";
          return;
        }
        if (!success) {
          const message = payload.error || payload.detail || t("titleError");
          titleResult.innerHTML = `<div class="field-value" style="color: var(--danger);">${escapeHtml(String(message))}</div>`;
          return;
        }
        const best = payload.best_target_path || "";
        const alternatives = Array.isArray(payload.alternatives) ? payload.alternatives : [];
        const altHtml = alternatives.length
          ? `<ul style="padding-left: 18px; margin: 6px 0;">${alternatives.map((a) => `<li>${escapeHtml(String(a))}</li>`).join("")}</ul>`
          : `<div class="field-value">${t("titleNoAlternatives")}</div>`;

        titleResult.innerHTML = `
          <div class="field-group">
            <div class="field-label">${t("titleBestPath")}</div>
            <div class="field-value large">${best ? escapeHtml(String(best)) : t("unknownCategory")}</div>
          </div>
          <div class="field-group">
            <div class="field-label">${t("titleAlternatives")}</div>
            ${altHtml}
          </div>
        `;
      }

      // æ›´æ–°æ–‡ä»¶åˆ—è¡¨
      function updateFileList() {
        previewGrid.innerHTML = "";
        fileCount.textContent = selectedFiles.length;
        updatePreviewLabel();
        
        if (selectedFiles.length === 0) {
          previewContainer.style.display = "none";
          return;
        }
        
        previewContainer.style.display = "block";
        
        selectedFiles.forEach((fileObj, index) => {
          const item = document.createElement("div");
          item.className = "preview-item";
          item.dataset.index = index;
          
          const img = document.createElement("img");
          img.src = fileObj.url;
          
          const info = document.createElement("div");
          info.className = "info";
          info.textContent = `${fileObj.file.name} (${formatBytes(fileObj.file.size)})`;
          
          const removeBtn = document.createElement("button");
          removeBtn.className = "remove-btn";
          removeBtn.innerHTML = "Ã—";
          removeBtn.onclick = (e) => {
            e.stopPropagation();
            selectedFiles.splice(index, 1);
            updateFileList();
          };
          
          item.appendChild(img);
          item.appendChild(info);
          item.appendChild(removeBtn);
          previewGrid.appendChild(item);
        });
      }

      // æ–‡ä»¶é€‰æ‹©å¤„ç†
      function handleFiles(files) {
        const newFiles = Array.from(files).filter(f => f.type.startsWith("image/"));
        
        newFiles.forEach(file => {
          const reader = new FileReader();
          reader.onload = (e) => {
            selectedFiles.push({
              file: file,
              url: e.target.result,
              status: "pending"
            });
            updateFileList();
          };
          reader.readAsDataURL(file);
        });
      }

      // äº‹ä»¶ç›‘å¬
      imageInput.addEventListener("change", (e) => {
        handleFiles(e.target.files);
      });

      uploadArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadArea.classList.add("drag-over");
      });

      uploadArea.addEventListener("dragleave", () => {
        uploadArea.classList.remove("drag-over");
      });

      uploadArea.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadArea.classList.remove("drag-over");
        handleFiles(e.dataTransfer.files);
      });

      clearFilesBtn.addEventListener("click", () => {
        selectedFiles = [];
        imageInput.value = "";
        updateFileList();
      });

      // // åˆ‡æ¢ä»·æ ¼æ¨¡å‹è¾“å…¥å¯è§æ€§
      // function updatePriceModelVisibility() {
      //   if (priceStrategySelect.value === "dedicated") {
      //     priceModelRow.style.display = "block";
      //   } else {
      //     priceModelRow.style.display = "none";
      //   }
      // }
      // priceStrategySelect.addEventListener("change", updatePriceModelVisibility);
      // updatePriceModelVisibility();
      uiLanguageSelect.addEventListener("change", () => {
        uiLanguage = uiLanguageSelect.value === "ja" ? "ja" : "zh";
        localStorage.setItem("mercari_ui_lang", uiLanguage);
        applyTranslations();
      });

      // æ‰¹é‡å¤„ç†
      async function processFiles() {
        if (selectedFiles.length === 0) {
          alert(t("alertNoFiles"));
          return;
        }
        
        const endpoint = apiInput.value.trim() || '/api/v1/mercari/image/analyze';
        if (!endpoint) {
          alert(t("alertNoEndpoint"));
          return;
        }
        
        testResults = [];
        resultsList.innerHTML = "";
        
        processing = true;
        submitBtn.disabled = true;
        buttonText.innerHTML = `<span class="spinner"></span> ${t("processingButton")}`;
        setStatus("processing");
        progressSection.style.display = "block";
        
        let completed = 0;
        const total = selectedFiles.length;
        
        for (let i = 0; i < selectedFiles.length; i++) {
          const fileObj = selectedFiles[i];
          const previewItem = previewGrid.children[i];
          
          // æ›´æ–°çŠ¶æ€
          previewItem.classList.add("processing");
          const statusBadge = document.createElement("div");
          statusBadge.className = "status-badge";
          statusBadge.textContent = t("statusBadgeProcessing");
          previewItem.appendChild(statusBadge);
          
          try {
            const formData = new FormData();
            formData.append("image", fileObj.file);
            formData.append("language", languageSelect.value);
            formData.append("category_count", categoryCountSelect.value || "1");
            formData.append("price_strategy", priceStrategySelect.value || "vision");
            if (visionModelInput?.value.trim()) formData.append("vision_model", visionModelInput.value.trim());
            if (categoryModelInput?.value.trim()) formData.append("category_model", categoryModelInput.value.trim());
            if (priceModelInput?.value.trim() && priceStrategySelect.value === "dedicated") {
              formData.append("price_model", priceModelInput.value.trim());
            }
            
            const start = performance.now();
            const resp = await fetch(endpoint, {
              method: "POST",
              body: formData,
            });
            
            const elapsedMs = performance.now() - start;
            const text = await resp.text();
            let payload = {};
            
            try {
              payload = JSON.parse(text);
            } catch (err) {
              payload = { error: t("jsonParseFailed"), raw: text };
            }
            
            // æ›´æ–°é¢„è§ˆçŠ¶æ€
            previewItem.classList.remove("processing");
            if (resp.ok) {
              previewItem.classList.add("success");
              statusBadge.textContent = t("badgeSuccess");
              statusBadge.style.background = "#dcfce7";
              statusBadge.style.color = "#15803d";
              
              // æ·»åŠ ç»“æœå¡ç‰‡
              addResultCard(fileObj, payload, elapsedMs, true);
            } else {
              previewItem.classList.add("error");
              statusBadge.textContent = t("badgeFail");
              statusBadge.style.background = "#fee2e2";
              statusBadge.style.color = "#991b1b";
              
              addResultCard(fileObj, payload, elapsedMs, false);
            }
          } catch (err) {
            previewItem.classList.remove("processing");
            previewItem.classList.add("error");
            statusBadge.textContent = t("badgeError");
            statusBadge.style.background = "#fee2e2";
            statusBadge.style.color = "#991b1b";
            
            addResultCard(fileObj, { error: String(err) }, 0, false);
          }
          
          completed++;
          progressText.textContent = `${completed} / ${total}`;
          const percent = (completed / total) * 100;
          progressPercent.textContent = `${percent.toFixed(0)}%`;
          progressFill.style.width = `${percent}%`;
        }
        
        processing = false;
        submitBtn.disabled = false;
        buttonText.textContent = t("startButton");
        setStatus("done");
      }

      async function submitTitleRequest() {
        const endpoint = titleApiInput.value.trim() || "/api/v1/mercari/title/analyze";
        const titleValue = titleInput.value.trim();
        const languageValue = titleLanguageSelect.value || "ja";
        const imageUrlValue = titleImageUrlInput.value.trim();

        if (!titleValue) {
          alert(t("alertNoTitle"));
          return;
        }

        titleProcessing = true;
        titleSubmitBtn.disabled = true;
        titleButtonText.innerHTML = `<span class="spinner"></span> ${t("titleProcessingButton")}`;

        const payload = {
          title: titleValue,
          language: languageValue,
        };
        if (imageUrlValue) payload.image_url = imageUrlValue;

        try {
          const resp = await fetch(endpoint, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          const text = await resp.text();
          let data;
          try {
            data = JSON.parse(text);
          } catch (err) {
            data = { error: t("jsonParseFailed"), raw: text };
          }

          if (resp.ok) {
            renderTitleResult(data, true);
          } else {
            const message = data.detail || data.error || text || t("titleError");
            renderTitleResult({ error: message }, false);
          }
        } catch (err) {
          renderTitleResult({ error: String(err) }, false);
        } finally {
          titleProcessing = false;
          titleSubmitBtn.disabled = false;
          titleButtonText.textContent = t("titleSubmitButton");
        }
      }

      function buildResultCard(entry) {
        const { fileObj, payload, elapsedMs, success, resultId } = entry;
        const card = document.createElement("div");
        card.className = "result-card";
        card.dataset.resultId = resultId;

        const structuredData = formatResultData(payload);
        const rawJson = JSON.stringify(payload, null, 2);
        const ratingValue = resultRatings[resultId];

        card.innerHTML = `
          <div class="result-header">
            <img src="${fileObj.url}" class="result-image" alt="result">
            <div class="result-meta">
              <div class="result-filename">${escapeHtml(fileObj.file.name)}</div>
              <div class="result-stats">
                <span>â±ï¸ ${(elapsedMs / 1000).toFixed(2)}s</span>
                <span>${success ? `<span style="color: var(--success)">âœ“ ${t("resultSuccess")}</span>` : `<span style="color: var(--danger)">âœ— ${t("resultFail")}</span>`}</span>
                <span>ğŸ“¦ ${formatBytes(fileObj.file.size)}</span>
              </div>
            </div>
          </div>
          
          <div class="result-structured">
            ${structuredData}
          </div>
          
          <button class="toggle-json" data-toggle-for="${resultId}" onclick="toggleJson('${resultId}', event)">
            <span>ğŸ“‹</span>
            <span class="toggle-text">${t("toggleShowJson")}</span>
          </button>
          
          <pre class="raw-json" id="json-${resultId}">${escapeHtml(rawJson)}</pre>
          
          ${success ? `
            <div class="rating-section">
              <label>${t("ratingLabel")}</label>
              <div class="rating-buttons">
                <button class="rating-btn accurate ${ratingValue === 'accurate' ? 'active' : ''}" onclick="rateResult('${resultId}', 'accurate', this)">${t("ratingAccurate")}</button>
                <button class="rating-btn moderate ${ratingValue === 'moderate' ? 'active' : ''}" onclick="rateResult('${resultId}', 'moderate', this)">${t("ratingModerate")}</button>
                <button class="rating-btn inaccurate ${ratingValue === 'inaccurate' ? 'active' : ''}" onclick="rateResult('${resultId}', 'inaccurate', this)">${t("ratingInaccurate")}</button>
              </div>
            </div>
          ` : ''}
        `;

        return card;
      }

      function renderResults() {
        resultsList.innerHTML = "";
        testResults.forEach((entry) => {
          const card = buildResultCard(entry);
          resultsList.appendChild(card);
        });
      }

      // æ·»åŠ ç»“æœå¡ç‰‡
      function addResultCard(fileObj, payload, elapsedMs, success) {
        const resultId = "result_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9);
        testResults.unshift({ fileObj, payload, elapsedMs, success, resultId });
        renderResults();
      }

      // åˆ‡æ¢ JSON æ˜¾ç¤º
      window.toggleJson = function(resultId, ev) {
        const jsonEl = document.getElementById(`json-${resultId}`);
        const toggleBtn = (ev && ev.currentTarget) || document.querySelector(`[data-toggle-for="${resultId}"]`);
        const toggleText = toggleBtn.querySelector('.toggle-text');
        
        if (jsonEl.classList.contains('show')) {
          jsonEl.classList.remove('show');
          toggleText.textContent = t("toggleShowJson");
        } else {
          jsonEl.classList.add('show');
          toggleText.textContent = t("toggleHideJson");
        }
      };

      // è¯„ä»·ç»“æœï¼ˆä¿®å¤é‡å¤è®¡æ•°é—®é¢˜ï¼‰
      window.rateResult = function(resultId, rating, btn) {
        const buttons = btn.parentElement.querySelectorAll(".rating-btn");
        
        // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„ active çŠ¶æ€
        buttons.forEach(b => b.classList.remove("active"));
        
        // æ¿€æ´»å½“å‰æŒ‰é’®
        btn.classList.add("active");
        
        // è®°å½•è¯„ä»·ï¼ˆä¼šè‡ªåŠ¨å¤„ç†æ—§è¯„ä»·çš„å‡æ³•ï¼‰
        recordRating(resultId, rating);
      };

      // æ¸…ç©ºç»Ÿè®¡
      clearStatsBtn.addEventListener("click", () => {
        if (confirm(t("confirmClearStats"))) {
          localStorage.removeItem(STORAGE_KEY);
          resultRatings = {};
          updateStatsDisplay();
          renderResults();
        }
      });

      // æ‹‰å–é»˜è®¤æ¨¡å‹ï¼ˆhealthï¼‰
      async function fetchDefaults() {
        try {
          const resp = await fetch("/health");
          const data = await resp.json();
          const models = data.models || {};
          if (models.vision_model) visionModelInput.value = models.vision_model;
          if (models.category_model) categoryModelInput.value = models.category_model;
          if (models.price_model) priceModelInput.value = models.price_model;
        } catch (e) {
          console.warn(t("warnDefaults"), e);
        }
      }

      // æäº¤å¤„ç†
      submitBtn.addEventListener("click", processFiles);
      titleSubmitBtn.addEventListener("click", submitTitleRequest);
      titleClearBtn.addEventListener("click", () => {
        titleInput.value = "";
        titleImageUrlInput.value = "";
        renderTitleResult(null, true);
      });
      tabImageBtn.addEventListener("click", () => setActiveTab("image"));
      tabTitleBtn.addEventListener("click", () => setActiveTab("title"));

      // åˆå§‹åŒ–
      applyTranslations();
      setStatus("idle");
      updateStatsDisplay();
      fetchDefaults();
      renderTitleResult(null, true);
    </script>
  </body>
</html>
